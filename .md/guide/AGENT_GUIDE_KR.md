# 에이전트 운영 프로토콜 및 워크플로우

> **버전**: 2.0 (병합 안전성 강화)
> **대상**: 자동화된 에이전트 및 AI 어시스턴트
> **목표**: 100개 이상의 동시 에이전트 세션 간 충돌 없는 통합.

## 1. 골든 룰 (작업 전 필독)

### 규칙 1: "먼저 읽고, 그 다음 쓰기" (Read First, Write Second)
함수, 파일, 스타일을 생성하기 전에 반드시 코드베이스를 검색하여 이미 존재하는지 확인하십시오.
*   *예시*: `lib/date.ts`에 `formatDate`가 있다면 `utils.ts`에 또 만들지 마세요.
*   *도구*: `grep_search` 또는 `find_by_name` 사용.

### 규칙 2: "원자적 범위" (Atomic Scope)
작업에 **반드시 필요한** 파일만 건드리십시오.
*   관련 없는 파일의 포맷팅(prettier/lint)을 수정하지 마세요. 다른 에이전트와 충돌합니다.
*   명시적 지시 없이 의존성 버전을 올리지 마세요.

### 규칙 3: "아키텍처 존중" (Preserve Architecture)
`ARCHITECTURE_KR.md`에 정의된 경계를 준수하십시오.
*   **프론트엔드 에이전트**: DB에 직접 쓰지 마세요. API를 사용하세요.
*   **백엔드 에이전트**: 컨트롤러에 비즈니스 로직을 넣지 마세요. 서비스를 사용하세요.

## 2. 표준 워크플로우 (Standardized Workflows)

### 프로토콜 A: 새 페이지 추가 (Frontend)
1.  **라우트 확인**: `app/[route]/page.tsx`가 없는지 확인.
2.  **디렉토리 생성**: `apps/web/app/[route]`.
3.  **페이지 생성**: `page.tsx` (`export default function Page()` 사용).
4.  **스타일 생성**: `page.module.css` (필요시).
5.  **링크 연결**: 최상위 네비게이션인 경우에만 `Sidebar.tsx`에 추가.

### 프로토콜 B: 백엔드 기능 추가
1.  **스키마 확인**: `schema.prisma`가 해당 데이터를 지원하는가?
    *   *아니오*: 스키마 업데이트 -> `db:push` -> 서버 재시작.
2.  **모듈 확인**: 도메인 모듈이 존재하는가? (예: `tweets/`).
    *   *예*: 기존 컨트롤러/서비스에 메서드 추가.
    *   *아니오*: 새 모듈 생성 -> `app.module.ts`에 등록.

### 프로토콜 C: 공유 컴포넌트 수정 (고위험)
*   **대상**: `Tweet.tsx`, `Sidebar.tsx`, `Feed.tsx`.
*   **위험도**: 충돌 확률 매우 높음.
*   **조치**:
    1.  파일 **전체 내용**을 먼저 읽어 최신 상태인지 확인하십시오.
    2.  `replace_file_content` 사용 시 **정확한** 컨텍스트(최소 3줄 이상의 유니크한 주변 코드)를 제공하십시오.
    3.  로직이 완전히 새로운 것이라면, 기존 컴포넌트를 비대하게 만드는 대신 *새 컴포넌트*를 만들어 import 하는 것을 고려하십시오.

## 3. 충돌 방지 전략 (Conflict Avoidance)

### 네이밍 충돌
*   **CSS 클래스**: `module.css` 내부에서도 가능한 **CamelCase**를 사용하여 라이브러리 클래스와 구분하십시오.
*   **테스트 파일**: 항상 `.spec.ts` 또는 `.test.tsx` 접미사를 사용하십시오.

### 상태 관리
*   **전역 상태**: 명시적 지시 없이 Redux/Zustand를 도입하지 마십시오. `useState` + Prop Drilling (1-2단계) 또는 Context (꼭 필요한 경우)를 사용하십시오.
*   **서버 상태**: 성능이 치명적이지 않다면 복잡한 클라이언트 캐싱보다 API 재요청을 선호하십시오(데이터 일관성 유지).

## 4. 검증 체크리스트 (완료 전 확인)
1.  **빌드 확인**: `pnpm dev`가 에러 없이 실행되는가?
2.  **타입 확인**: 새로운 TypeScript 에러가 없는가? (`any` 사용 지양).
3.  **린트 확인**: 사용하지 않는 변수가 남아있지 않은가?
4.  **자가 수정**: 파일을 수정했는데 빌드가 깨졌다면, 즉시 되돌리고(revert) 원인을 분석하십시오.
